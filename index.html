<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Best Store</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:tahoma;background:#0f172a;color:#fff}
header{background:#020617;padding:15px;display:flex;justify-content:space-between;align-items:center}
button{background:#2563eb;color:#fff;border:none;padding:8px 14px;border-radius:8px;cursor:pointer}
.hidden{display:none}
section{padding:15px}
.products{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:15px}
.card{background:#020617;padding:12px;border-radius:14px}
.card img{width:100%;border-radius:10px}
.delete{background:#dc2626;margin-top:6px}
.badge{background:#16a34a;padding:3px 7px;border-radius:6px;font-size:12px}
input,select,textarea{width:100%;margin:5px 0;padding:7px;border-radius:6px;border:none}
</style>
</head>
<body>

<header>
  <div>
    <b>BEST STORE</b><br>
    <small>Ø±ØµÙŠØ¯Ùƒ: <span id="balance">0</span></small>
  </div>
  <div>
    <span id="userEmail"></span>
    <button id="loginBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Google</button>
    <button id="logoutBtn" class="hidden">Ø®Ø±ÙˆØ¬</button>
  </div>
</header>

<section id="adminPanel" class="hidden">
  <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h3>
  <input id="pName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
  <input id="pPrice" placeholder="Ø§Ù„Ø³Ø¹Ø±">
  <select id="pCat">
    <option>ØªØ·Ø¨ÙŠÙ‚Ø§Øª</option>
    <option>Ø£Ø´ÙŠØ§Ø¡</option>
  </select>
  <textarea id="pDesc" placeholder="Ø§Ù„ÙˆØµÙ"></textarea>
  <input id="pQty" placeholder="Ø§Ù„Ø±ØµÙŠØ¯ / Ø§Ù„ÙƒÙ…ÙŠØ©">
  <input type="file" id="pImg">
  <button onclick="addProduct()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬</button>
</section>

<section class="products" id="products"></section>

<section class="card">
  <h3>ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø±ØµÙŠØ¯ Ø¹Ø¨Ø± Ø´Ø§Ù… ÙƒØ§Ø´</h3>
  <p>Ø§Ù„Ø­Ø³Ø§Ø¨: <b>29607b06505ee18f34a7fc5022404325</b></p>
  <input id="chargeAmount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
  <input type="file" id="chargeImg">
  <button onclick="sendCharge()">Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ¹Ø¨Ø¦Ø©</button>
</section>

<script type="module">
/* ğŸ”¥ Ø¶Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Firebase Ù‡Ù†Ø§ */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "PUT_API_KEY",
  authDomain: "PUT_AUTH_DOMAIN",
  projectId: "PUT_PROJECT_ID",
  storageBucket: "PUT_STORAGE_BUCKET",
  messagingSenderId: "PUT_SENDER_ID",
  appId: "PUT_APP_ID"
};

const ADMIN = "wled49645@gmail.com";

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);
const provider = new GoogleAuthProvider();

loginBtn.onclick = () => signInWithPopup(auth, provider);
logoutBtn.onclick = () => signOut(auth);

onAuthStateChanged(auth, async user => {
  if(!user) return;
  userEmail.innerText = user.email;
  loginBtn.classList.add("hidden");
  logoutBtn.classList.remove("hidden");

  const userRef = doc(db,"users",user.uid);
  const snap = await getDoc(userRef);
  if(!snap.exists()) await setDoc(userRef,{balance:0});
  balance.innerText = (await getDoc(userRef)).data().balance;

  if(user.email === ADMIN) adminPanel.classList.remove("hidden");
  loadProducts();
});

async function addProduct(){
  const file = pImg.files[0];
  const imgRef = ref(storage,"products/"+Date.now());
  await uploadBytes(imgRef,file);
  const url = await getDownloadURL(imgRef);

  await addDoc(collection(db,"products"),{
    name:pName.value,price:pPrice.value,cat:pCat.value,
    desc:pDesc.value,qty:pQty.value,img:url
  });
  loadProducts();
}

async function loadProducts(){
  products.innerHTML="";
  const q = await getDocs(collection(db,"products"));
  q.forEach(d=>{
    const p=d.data();
    products.innerHTML+=`
    <div class="card">
      <img src="${p.img}">
      <h4>${p.name}</h4>
      <span class="badge">${p.cat}</span>
      <p>${p.desc}</p>
      <p>Ø§Ù„Ø±ØµÙŠØ¯: ${p.qty}</p>
      <b>${p.price}</b>
      ${auth.currentUser?.email===ADMIN?
      `<button class="delete" onclick="deleteProduct('${d.id}')">Ø­Ø°Ù</button>`:""}
    </div>`;
  });
}

window.deleteProduct = async id =>{
  await deleteDoc(doc(db,"products",id));
  loadProducts();
};

async function sendCharge(){
  const file=chargeImg.files[0];
  const refImg=ref(storage,"charges/"+Date.now());
  await uploadBytes(refImg,file);
  const url=await getDownloadURL(refImg);

  await addDoc(collection(db,"charges"),{
    uid:auth.currentUser.uid,
    amount:chargeAmount.value,
    img:url
  });
  alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ¹Ø¨Ø¦Ø©");
}
</script>

</body>
</html>
