<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Best Store</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:tahoma;background:#0f172a;color:#fff}
header{background:#020617;padding:15px;display:flex;justify-content:space-between;align-items:center}
button{background:#2563eb;color:#fff;border:none;padding:8px 14px;border-radius:8px;cursor:pointer}
input,select{width:100%;padding:8px;margin:5px 0;border-radius:6px;border:none}
.hidden{display:none}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:15px;padding:15px}
.card{background:#020617;padding:12px;border-radius:12px;text-align:center}
.card img{width:100%;border-radius:10px}
.nav{display:flex;gap:10px;padding:10px}
.nav button{flex:1}
</style>
</head>

<body>

<header>
  <b>BEST STORE</b>
  <div id="userBox">
    <button onclick="openAuth()">تسجيل / دخول</button>
  </div>
</header>

<!-- اختيار الأقسام -->
<div class="nav">
  <button onclick="setSection('apps')">التطبيقات</button>
  <button onclick="setSection('games')">الألعاب</button>
  <button onclick="setSection('charge')">شحن الألعاب</button>
</div>

<!-- تسجيل -->
<div id="authBox" class="card hidden">
  <h3>إنشاء حساب / دخول</h3>
  <input id="name" placeholder="الاسم">
  <input id="email" placeholder="البريد الإلكتروني">
  <input id="password" type="password" placeholder="كلمة السر">
  <select id="currency">
    <option value="SYP">ليرة سورية</option>
    <option value="TRY">ليرة تركية</option>
    <option value="USD">دولار أمريكي</option>
  </select>
  <button onclick="register()">إنشاء حساب</button>
  <button onclick="login()">تسجيل الدخول</button>
</div>

<!-- لوحة الأدمن -->
<div id="adminPanel" class="card hidden">
  <h3>لوحة الأدمن</h3>
  <input id="pName" placeholder="اسم المنتج">
  <select id="pSection">
    <option value="apps">تطبيقات</option>
    <option value="games">ألعاب</option>
    <option value="charge">شحن ألعاب</option>
  </select>
  <input id="pPrice" placeholder="السعر">
  <input type="file" id="pImg">
  <button onclick="addProduct()">إضافة</button>
</div>

<!-- المنتجات -->
<div id="products" class="grid"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendEmailVerification, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-storage.js";

const firebaseConfig={
  apiKey:"PUT_API_KEY",
  authDomain:"PUT_AUTH_DOMAIN",
  projectId:"PUT_PROJECT_ID",
  storageBucket:"PUT_STORAGE_BUCKET",
  messagingSenderId:"PUT_SENDER_ID",
  appId:"PUT_APP_ID"
};

const ADMIN="wled49645@gmail.com";
let currentSection="apps";

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);
const storage=getStorage(app);

window.openAuth=()=>authBox.classList.toggle("hidden");
window.setSection=s=>{currentSection=s;loadProducts();};

window.register=async()=>{
  const user=await createUserWithEmailAndPassword(auth,email.value,password.value);
  await sendEmailVerification(user.user);
  alert("تم إرسال رسالة تحقق إلى بريدك");
};

window.login=async()=>{
  const u=await signInWithEmailAndPassword(auth,email.value,password.value);
  if(!u.user.emailVerified){
    alert("يرجى تفعيل الحساب من الإيميل");
    return;
  }
};

onAuthStateChanged(auth,u=>{
  if(!u)return;
  userBox.innerText=u.email;
  authBox.classList.add("hidden");
  if(u.email===ADMIN) adminPanel.classList.remove("hidden");
});

window.addProduct=async()=>{
  const file=pImg.files[0];
  const imgRef=ref(storage,"products/"+Date.now());
  await uploadBytes(imgRef,file);
  const url=await getDownloadURL(imgRef);

  await addDoc(collection(db,"products"),{
    name:pName.value,
    section:pSection.value,
    price:pPrice.value,
    img:url
  });
  loadProducts();
};

async function loadProducts(){
  products.innerHTML="";
  const q=await getDocs(collection(db,"products"));
  q.forEach(d=>{
    const p=d.data();
    if(p.section===currentSection){
      products.innerHTML+=`
      <div class="card">
        <img src="${p.img}">
        <h4>${p.name}</h4>
        <b>${p.price}</b>
      </div>`;
    }
  });
}

loadProducts();
</script>

</body>
</html>
